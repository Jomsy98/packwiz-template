<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>[Modpack Name] — Info</title>
    <meta name="description" content="Install instructions, included mods, and changelog for [Modpack Name]" />
    <link rel="stylesheet" href="./styles.css">
  </head>
  <body>
    <div class="container">
      <header class="header">
        <div class="logo-wrap">
          <img id="logoImg" alt="modpack logo" src="./server-icon.png" onerror="this.onerror=null;this.src='prism/modpack.png'" />
        </div>
        <div>
          <h1 id="packName">[Modpack Name]</h1>
          <p class="lead">A custom Minecraft modpack. Replace this text with a short description of your pack.</p>
        </div>
      </header>

      <div class="grid">
        <main>
          <section class="card install-steps">
            <h2>How to install</h2>
            <p class="small">Quick steps to get started with Prism Launcher</p>
            <ol>
              <li>Install <a href="https://prismlauncher.org/" style="color:var(--accent);text-decoration:none">Prism Launcher</a> (Windows / macOS / Linux).</li>
              <li>Right click the "Download Pack" button below and copy the url. Or download the file directly.</li>
              <li>Open Prism and import the downloaded pack. You can paste the url and prism will download it directly.</li>
              <li>Launch the modpack and enjoy!</li>
            </ol>
            <div style="margin-top:12px">
              <a class="btn" id="downloadBtn" href="#">Download Pack (prism.zip)</a>
            </div>
          </section>

          <section class="card" style="margin-top:18px">
            <h2>Changelog</h2>
            <div id="changelog">
              <div class="changelog-item">
                <strong>1.0.0</strong> <span class="meta">— Initial release</span>
                <div class="small">Added base mods and default configuration.</div>
              </div>
              <div class="changelog-item">
                <strong>Unreleased</strong> <span class="meta">— Work in progress</span>
                <div class="small">Planned updates and fixes go here.</div>
              </div>
            </div>
          </section>
        </main>

        <aside>
          <div id="modsCard" class="card mods-card-extended">
            <h3>Included mods</h3>
            <ul id="modsList" class="mods-list">
              <li>Loading...</li>
            </ul>
            <div style="margin-top:8px"></div>
          </div>
        </aside>
      </div>

    </div>

    <script>
      (function(){
        // Fill repo info placeholders (replace %USER% and %REPO% at build time if desired)
        const user = '%USER%';
        const repo = '%REPO%';
        const repoSpan = document.getElementById('repoInfo');
        if(repoSpan){
          if(user !== '%USER%' && repo !== '%REPO%') repoSpan.textContent = `${user}/${repo}`;
        }

        // Set download link to the repository latest release asset if repo info is present
        const dl = document.getElementById('downloadBtn');
        if(dl){
          if(user !== '%USER%' && repo !== '%REPO%'){
            dl.href = `https://github.com/${user}/${repo}/releases/latest/download/prism.zip`;
          } else {
            // fallback to local prism.zip
            dl.href = './prism.zip';
          }
        }

        // Minimal loader: try a few simple relative paths (keeps logic small)
        async function loadMods(){
          const preview = document.getElementById('modsList');
          const modsError = document.getElementById('modsError');
          const candidates = [ './mods.json', 'mods.json', './mods/mods.json', './site/mods.json', 'site/mods.json' ];
          let lastErr = null;
          for(const path of candidates){
            try{
              const res = await fetch(path);
              if(!res.ok){ lastErr = new Error(`${path} -> HTTP ${res.status}`); continue; }
              const mods = await res.json();
              preview.innerHTML = '';
              if(!Array.isArray(mods) || mods.length === 0){
                preview.innerHTML = '<li class="small">No mods listed in mods.json.</li>';
              } else {
                mods.forEach(m => {
                  const li = document.createElement('li');
                  li.innerHTML = `<strong>${m.name}</strong>${m.desc ? ' — '+m.desc : ''}`;
                  preview.appendChild(li);
                });
              }
              if(modsError) modsError.style.display = 'none';
              return; // success
            }catch(e){
              lastErr = e;
            }
          }
          // if we get here, all attempts failed
          preview.innerHTML = '<li class="small">No mods list available. Add mods.json to populate this list.</li>';
          if(modsError){ modsError.style.display='block'; modsError.textContent = `Failed to load mods.json (tried ${candidates.join(', ')}). Last error: ${lastErr ? lastErr.message : 'unknown'}`; }
        }

        loadMods();
      })();
    </script>
  </body>
</html>
